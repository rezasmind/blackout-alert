<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  
  <Fragment>
    <!-- Application Components -->
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">

      <!-- Main Application Files -->
      <Component Id="PowerGuardExeComponent">
        <File Id="PowerGuardExe"
              Source="$(var.PowerGuardBinPath)PowerGuard.exe"
              KeyPath="yes" />
      </Component>

      <Component Id="PowerGuardDllComponent">
        <File Id="PowerGuardDll"
              Source="$(var.PowerGuardBinPath)PowerGuard.dll" />
      </Component>

      <Component Id="PowerGuardRuntimeConfigComponent">
        <File Id="PowerGuardRuntimeConfig"
              Source="$(var.PowerGuardBinPath)PowerGuard.runtimeconfig.json" />
      </Component>

      <Component Id="PowerGuardDepsComponent">
        <File Id="PowerGuardDeps"
              Source="$(var.PowerGuardBinPath)PowerGuard.deps.json" />
      </Component>

      <!-- .NET Runtime Dependencies -->
      <Component Id="SystemManagementComponent">
        <File Id="SystemManagementDll"
              Source="$(var.PowerGuardBinPath)System.Management.dll" />
      </Component>

      <!-- All other DLL files from the build output -->
      <Component Id="AllDependenciesComponent">
        <!-- This will include all remaining DLL files -->
        <File Id="MicrosoftWin32RegistryDll"
              Source="$(var.PowerGuardBinPath)Microsoft.Win32.Registry.dll" />
        <File Id="SystemSecurityAccessControlDll"
              Source="$(var.PowerGuardBinPath)System.Security.AccessControl.dll" />
        <File Id="SystemSecurityPrincipalWindowsDll"
              Source="$(var.PowerGuardBinPath)System.Security.Principal.Windows.dll" />
        <!-- Add more dependencies as needed -->
      </Component>

    </ComponentGroup>

    <!-- Start Menu Shortcut Component -->
    <Component Id="ApplicationShortcut" Directory="ApplicationProgramsFolder">
      <Shortcut Id="ApplicationStartMenuShortcut"
                Name="محافظ برق"
                Description="محافظ برق - جلوگیری از از دست رفتن داده‌ها در هنگام قطعی برق"
                Target="[INSTALLFOLDER]PowerGuard.exe"
                WorkingDirectory="INSTALLFOLDER"
                Icon="PowerGuardIcon" />
      <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall" />
      <RegistryValue Root="HKCU" 
                     Key="Software\PowerGuard\Shortcuts" 
                     Name="StartMenu" 
                     Type="integer" 
                     Value="1" 
                     KeyPath="yes" />
    </Component>

    <!-- Desktop Shortcut Component -->
    <Component Id="DesktopShortcut" Directory="DesktopFolder">
      <Shortcut Id="ApplicationDesktopShortcut"
                Name="محافظ برق"
                Description="محافظ برق - جلوگیری از از دست رفتن داده‌ها در هنگام قطعی برق"
                Target="[INSTALLFOLDER]PowerGuard.exe"
                WorkingDirectory="INSTALLFOLDER"
                Icon="PowerGuardIcon" />
      <RegistryValue Root="HKCU" 
                     Key="Software\PowerGuard\Shortcuts" 
                     Name="Desktop" 
                     Type="integer" 
                     Value="1" 
                     KeyPath="yes" />
    </Component>

    <!-- Registry Entries Component -->
    <Component Id="RegistryEntries" Directory="INSTALLFOLDER">
      <!-- Application Registration -->
      <RegistryKey Root="HKLM" Key="SOFTWARE\PowerGuard">
        <RegistryValue Name="InstallPath" Type="string" Value="[INSTALLFOLDER]" />
        <RegistryValue Name="Version" Type="string" Value="$(var.PowerGuardVersion)" />
        <RegistryValue Name="DisplayName" Type="string" Value="محافظ برق - PowerGuard" />
      </RegistryKey>

      <!-- Uninstall Information -->
      <RegistryKey Root="HKLM" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\PowerGuard">
        <RegistryValue Name="DisplayName" Type="string" Value="محافظ برق - PowerGuard" />
        <RegistryValue Name="DisplayVersion" Type="string" Value="$(var.PowerGuardVersion)" />
        <RegistryValue Name="Publisher" Type="string" Value="PowerGuard Team" />
        <RegistryValue Name="InstallLocation" Type="string" Value="[INSTALLFOLDER]" />
        <RegistryValue Name="UninstallString" Type="string" Value="MsiExec.exe /X[ProductCode]" />
        <RegistryValue Name="DisplayIcon" Type="string" Value="[INSTALLFOLDER]PowerGuard.exe" />
        <RegistryValue Name="NoModify" Type="integer" Value="1" />
        <RegistryValue Name="NoRepair" Type="integer" Value="1" />
        <RegistryValue Name="EstimatedSize" Type="integer" Value="10240" />
      </RegistryKey>

      <!-- File Association (Optional) -->
      <RegistryKey Root="HKLM" Key="SOFTWARE\Classes\.powerguard">
        <RegistryValue Type="string" Value="PowerGuard.Settings" />
      </RegistryKey>

      <RegistryKey Root="HKLM" Key="SOFTWARE\Classes\PowerGuard.Settings">
        <RegistryValue Type="string" Value="PowerGuard Settings File" />
        <RegistryKey Key="DefaultIcon">
          <RegistryValue Type="string" Value="[INSTALLFOLDER]PowerGuard.exe,0" />
        </RegistryKey>
        <RegistryKey Key="shell\open\command">
          <RegistryValue Type="string" Value="&quot;[INSTALLFOLDER]PowerGuard.exe&quot; &quot;%1&quot;" />
        </RegistryKey>
      </RegistryKey>

      <RegistryValue Root="HKLM" 
                     Key="SOFTWARE\PowerGuard" 
                     Name="Installed" 
                     Type="integer" 
                     Value="1" 
                     KeyPath="yes" />
    </Component>

    <!-- Icon Definition -->
    <Icon Id="PowerGuardIcon" SourceFile="$(var.PowerGuardBinPath)PowerGuard.exe" />

  </Fragment>
</Wix>
